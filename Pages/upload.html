<!DOCTYPE html>
<html lang="en">
<head>
    <link
        rel="icon"
        type="image/x-icon"
        href="/Resources/Favicons/favicon.png"
    />
    <link rel="stylesheet" href="/Pages/style.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script>
                window.addEventListener("DOMContentLoaded", (event) => {
            fetch("/Pages/navbar.html")
                .then((response) => response.text())
                .then((data) => {
                    document.getElementById("navbar").innerHTML = data;
                });
            fetch("/Pages/socials.html")
                .then((response) => response.text())
                .then((data) => {
                    document.getElementById("socials").innerHTML = data;
                });
        });
    </script>
</head>

<body>
    <div id="navbar"></div>

    <div class="container">
        <h2>Image Uploader</h2>
        <p>Here you can upload pictures of the team. Thank you for your suppourt</p>
        <form action=" " method="post" enctype="multipart/form-data">
            <label for="file-upload" class="upload-btn">Choose Image</label>
            <input type="file" id="file-upload" name="file" accept="image/*">
            <br>
            <br>
            <button type="submit" class="up-btn">Upload</button>
        </form>
        <div id="image-preview">
            <h3>Uploaded Image:</h3>
            <img id="uploaded-image" src="#" alt="Uploaded Image">
        </div>
    </div>
    <script>
        // Replace with your OneDrive API credentials
        const clientId = 'YOUR_CLIENT_ID';
        const redirectUri = 'YOUR_REDIRECT_URI';
        const scopes = 'Files.ReadWrite.All';
        var f;
        document.getElementById('file-upload').addEventListener('change', function(event) {
            const fileInput = event.target;
            const file = fileInput.files[0];
            const reader = new FileReader();
            f = file;
            reader.onload = function(e) {
                const imagePreview = document.getElementById('uploaded-image');
                imagePreview.src = e.target.result;
            }
            reader.readAsDataURL(file);
        });

        function getToken() {
            return new Promise((resolve, reject) => {
                const url = `https://login.microsoftonline.com/common/oauth2/v2.0/token`;

                // Make a POST request to get an access token
                axios.post(url, {
                    client_id: clientId,
                    redirect_uri: redirectUri,
                    scope: scopes,
                    grant_type: 'client_credentials'
                })
                .then(response => {
                    resolve(response.data.access_token);
                })
                .catch(error => {
                    reject(error);
                });
            });
        }

        function uploadToOneDrive(accessToken) {
            const url = 'https://graph.microsoft.com/v1.0/me/drive/root:/path/to/upload/' + f.name + ':/content';

            // Prepare the request headers
            const headers = {
                'Authorization': `Bearer ${accessToken}`,
                'Content-Type': f.type
            };

            // Make a PUT request to upload the file
            axios.put(url, f, { headers: headers })
                .then(response => {
                    console.log('File uploaded successfully:', response.data);
                    alert('File uploaded successfully!');
                })
                .catch(error => {
                    console.error('Error uploading file:', error.response.data.error);
                    alert('Error uploading file. See console for details.');
                });
        }
    </script>
    <div id="socials"></div>
</body>
</html>